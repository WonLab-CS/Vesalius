<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Vesalius: Quick Start • vesalius</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Vesalius: Quick Start">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vesalius</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/vesalius.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Vesalius_Analysis/Spatial_DNA_seq.html">Vesalius: Spatial Genomics</a></li>
    <li><a class="dropdown-item" href="../articles/Vesalius_Analysis/Spatial_RNA_seq.html">Vesalius: Spatial Transcriptomics</a></li>
    <li><a class="dropdown-item" href="../articles/Vesalius_Analysis/Vesalius_MSB_analysis.html">Vesalius: MSB Manuscript Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/patrickCNMartin/Vesalius/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Vesalius: Quick Start</h1>
                        <h4 data-toc-skip class="author">Patrick C.N.
Martin</h4>
            
            <h4 data-toc-skip class="date">2025-01-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/patrickCNMartin/Vesalius/blob/main/vignettes/vesalius.Rmd" class="external-link"><code>vignettes/vesalius.Rmd</code></a></small>
      <div class="d-none name"><code>vesalius.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="vesalius-quick-start">Vesalius: Quick Start<a class="anchor" aria-label="anchor" href="#vesalius-quick-start"></a>
</h2>
<p>Do you like to live in the fast lane? Do you sigh every time you see
a long vignette? Do you wish there was a TLDR on everything?</p>
<p>I understand.</p>
<p>Welcome to the Vesalius quick start!</p>
<p>In this vignette, you will find a <strong>very</strong> short guide
on how to work with Vesalius. Vesalius provides an internal data set
taken from real Spatial transcrtiptomic data.</p>
<p>We show <em>in context</em> Vesalius workflows in the articles
section.</p>
<p>For all intents and purposes, this is a dummy data set and should
only be used to get a feel for the Vesalius package. We strongly advise
you to use real and complete data sets to fully understand the Vesalius
package and its benefits.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Vesalius is a tool to perform high-resolution in silico anatomization
and molecular characterization from Spatial omices data without
requiring companion images. The nature of the vesalius algorithm makes
it condusive to being using on various spatial omics modalities without
requiuring substantial changes.</p>
<p>Vesalius achieves this by converting reducded dimensionality latent
space into gray scale images (one of each dimension). These images are
processed using various image analysis techniques such as smoothing and
segmentation.</p>
</div>
<div class="section level2">
<h2 id="loading-building-a-vesalius-assay">Loading &amp; building a vesalius assay<a class="anchor" aria-label="anchor" href="#loading-building-a-vesalius-assay"></a>
</h2>
<div class="section level3">
<h3 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<p>First, let’s load the package and the data. Data originates from
slide-seqV2 data (availble at <a href="https://singlecell.broadinstitute.org/single_cell/study/SCP948/robust-decomposition-of-cell-type-mixtures-in-spatial-transcriptomics#study-download" class="external-link">Single
Cell Portal</a>).</p>
<p>We took a small subset of the mouse hippocampus centered around the
Dentate Gyrus.</p>
<p>Here, we show an example using transcriptomic data but the same
principles will apply for other modalities. For examples using other
modalities, please refer to the other articles.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patrickcnmartin.github.io/Vesalius/" class="external-link">vesalius</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vesalius</span>, package <span class="op">=</span> <span class="st">"vesalius"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="what-do-we-have">What do we have?<a class="anchor" aria-label="anchor" href="#what-do-we-have"></a>
</h4>
<p>Once loaded we have two new variables: counts and cooridnates.</p>
<p>The counts are the gene counts for all genes. As per convention,
columns r epresent the spatial indices (barcodes, spots, beads,…) and
rows are the genes that were captured.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'dgCMatrix' [package "Matrix"] with 6 slots</span></span>
<span><span class="co">##   ..@ i       : int [1:653622] 4 8 10 15 18 19 30 38 41 51 ...</span></span>
<span><span class="co">##   ..@ p       : int [1:1053] 0 2982 6344 9623 12651 15540 18593 21462 24241 26859 ...</span></span>
<span><span class="co">##   ..@ Dim     : int [1:2] 15932 1052</span></span>
<span><span class="co">##   ..@ Dimnames:List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:15932] "0610005C13Rik" "0610007P14Rik" "0610009B22Rik" "0610009E02Rik" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:1052] "CTCCAGCCTTGCAT" "AACCCCAAGGTAAT" "GCCCAACACACTTT" "GTCCAGAGTCTTAT" ...</span></span>
<span><span class="co">##   ..@ x       : num [1:653622] 1 4 1 2 2 2 2 1 1 1 ...</span></span>
<span><span class="co">##   ..@ factors : list()</span></span></code></pre>
<p>The coordinates represent the x and y coordinates for each spatial
index.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    1052 obs. of  3 variables:</span></span>
<span><span class="co">##  $ barcodes: chr  "CTCCAGCCTTGCAT" "AACCCCAAGGTAAT" "GCCCAACACACTTT" "GTCCAGAGTCTTAT" ...</span></span>
<span><span class="co">##  $ xcoord  : num  3536 3472 3634 3589 3535 ...</span></span>
<span><span class="co">##  $ ycoord  : num  3485 3410 3636 3257 3352 ...</span></span></code></pre>
<p>In other modalities, count matrices are still required for vesalius
to run.</p>
<p>For example, Spatial-ATAC-seq or Spatial-cut&amp;tag can be converted
into count matrices (more specifically tile matrices) using the <a href="https://www.archrproject.com/" class="external-link">ArchR package</a></p>
</div>
</div>
<div class="section level3">
<h3 id="building-a-vesalius-assay">Building a Vesalius assay<a class="anchor" aria-label="anchor" href="#building-a-vesalius-assay"></a>
</h3>
<p>We can build a vesalius assay by simply parsing both counts and
cooridnates to the (vesalius assay contructor)[link to manual page].</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_vesalius_assay.html">build_vesalius_assay</a></span><span class="op">(</span></span>
<span>  coordinates <span class="op">=</span> <span class="va">coordinates</span>, <span class="co"># spatial coordinates</span></span>
<span>  counts  <span class="op">=</span> <span class="va">counts</span>, <span class="co"># count matrix</span></span>
<span>  assay <span class="op">=</span> <span class="st">"spatial_omics"</span>, <span class="co"># name you wish to give your assay</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Do you want progress messages?</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="what-do-we-have-1">What do we have?<a class="anchor" aria-label="anchor" href="#what-do-we-have-1"></a>
</h4>
<p>A vesalius object is a container that requires at the very least
spatial indices. Here, we parsed both counts and spatial indices</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## spatial_omics as vesalius assay containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1 modifications applied to base object. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1052 spatial indices. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 15932 observations in the raw count matrix. </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>Count matrices can be added sperately using the
<code>add_counts</code> function.</p>
</div>
</div>
<div class="section level3">
<h3 id="interoperability">Interoperability<a class="anchor" aria-label="anchor" href="#interoperability"></a>
</h3>
<p>UNDER CONSTRCUTION!</p>
<p>We are currently working on making Vesalis fully compatible with
SpatialFeatureExperiments, SingleCellExperiment and anndata.</p>
</div>
</div>
<div class="section level2">
<h2 id="embedding-latent-space-into-gray-scale-images">Embedding latent space into gray scale images<a class="anchor" aria-label="anchor" href="#embedding-latent-space-into-gray-scale-images"></a>
</h2>
<div class="section level3">
<h3 id="embed-latent-space">Embed Latent Space<a class="anchor" aria-label="anchor" href="#embed-latent-space"></a>
</h3>
<p>We can use this object top embed our latent space into grey scale
images.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dim_reduction <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"log_norm"</span>,</span>
<span>  nfeatures <span class="op">=</span> <span class="fl">100</span>, <span class="co"># Setting number of features low for low run time</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="what-do-we-have-2">What do we have?<a class="anchor" aria-label="anchor" href="#what-do-we-have-2"></a>
</h4>
<p>We see that we have added a set of embedding with one used one
default embedding called the “active” embedding. See section below on
<em>understanding active embeddings</em>.</p>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## spatial_omics as vesalius assay containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 3 modifications applied to base object. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1052 spatial indices used to form pixel tiles. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 15932 observations in the log_norm count matrix. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## PCA as embeddings. </span></span>
<span><span class="co">## with PCA as active embedding. </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="testing-multiple-embeddings">Testing multiple embeddings<a class="anchor" aria-label="anchor" href="#testing-multiple-embeddings"></a>
</h3>
<p>We can test out multiple embeddings and every trial will be stored
into the <code>vesalius_assay</code> object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dim_reduction <span class="op">=</span> <span class="st">"UMAP"</span>,</span>
<span>  nfeatures <span class="op">=</span> <span class="fl">100</span>, <span class="co"># Setting number of features low for low run time</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dim_reduction <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  nfeatures <span class="op">=</span> <span class="fl">200</span>, <span class="co"># Setting number of features low for low run time</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dim_reduction <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Every time you run a new dimensionality reduction approach it will be
appended to the previous ones. Vesalius does the same thing for
different normalisation approaches. This lets you decided which
combination you would want to use in later stages.</p>
<p>Note that since you might be want to use the same embedding more than
once, you will end up with more than one embedding called “PCA” for
example. In this case, each embedding or normalisation will have a
unique name.</p>
<p>For every subsequent embedding called PCA, the trial name will be
PCA.1, PCA.2 etc The same applies to any embedding or normalisation
method you select.</p>
<div class="section level4">
<h4 id="what-do-we-have-3">What do we have ?<a class="anchor" aria-label="anchor" href="#what-do-we-have-3"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## spatial_omics as vesalius assay containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 6 modifications applied to base object. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1052 spatial indices used to form pixel tiles. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 15932 observations in the log_norm.3 count matrix. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 4 total embedding trials</span></span>
<span><span class="co">## with PCA.2 as active embedding. </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>You can also add your own embeddings and they will be appended into
vesalius in a similar manner. You can also check the manual page for
<code>add_embeddings</code></p>
</div>
</div>
<div class="section level3">
<h3 id="visualising-grey-scale-images">Visualising Grey scale images<a class="anchor" aria-label="anchor" href="#visualising-grey-scale-images"></a>
</h3>
<p>To visualise embeddings, we can simply plot the vesalius object and
specify which dimension we wish to view. See (imagePlot)[link to page]
for more information. Since we are leaving the embedding argument as the
default “last” value, we can only look at the 3 UMAP dimensions. We can
look at them simulaneously by creating RGB images with one dimension per
color channel.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">vesalius</span>, dimensions <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Grey PCA dim 1"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">vesalius</span>, dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"RGB PCA"</span><span class="op">)</span></span></code></pre></div>
<p>If we wanted to look at “UMAP” instead, we can simply specify the
embedding. Since we used 30 dimensions for UMAP, we can use any
dimensions to build RGB images.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">vesalius</span>, dimensions <span class="op">=</span> <span class="fl">1</span>, embedding <span class="op">=</span> <span class="st">"UMAP"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Grey UMAP dim 1"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">vesalius</span>, dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, embedding <span class="op">=</span> <span class="st">"UMAP"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"RGB UMAP dim 1, 2, and 3"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span><span class="op">)</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/out_plot_grey-1.png" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="understanding-active-embeddings">Understanding Active Embeddings<a class="anchor" aria-label="anchor" href="#understanding-active-embeddings"></a>
</h2>
<p>The active embedding slot in a <code>vesalius_assay</code> object
contains the embedding values that will be used during image processing
and image segmentation.</p>
<p>In the examples above, we tested multiple embeddings.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_active_embedding_tag.html">get_active_embedding_tag</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "PCA.2"</span></span></code></pre>
<p>We see that “UMAP.1” is used as the active embedding. Any time the
embeddings are being used in subsequent functions they will be taken
from here as this is the “last” embedding used.</p>
<p>In fact, in any subsequent function that contains the keyword “last”
for one of its arguments, vesalius will use the last target created.
This can mean the last embedding used, the last count matrix or the last
segmentation / territory isolation / territory morphology used.</p>
<p>If you are unstaified with the results, you can always call the
embedding or trial you want to use explictely and the active slot will
be replace with a fresh version of your embeddings of choice. No need to
re-run everything from scratch!</p>
<p>While this flexibility can be a boon, it can also be a curse! Anytime
you explictely request an embedding or a trial it will use that fresh
instance. This means that every time the active slot will be updated and
any processing you may have done to it will be overwritten.</p>
</div>
<div class="section level2">
<h2 id="image-processing-and-image-segmentation">Image processing and Image segmentation<a class="anchor" aria-label="anchor" href="#image-processing-and-image-segmentation"></a>
</h2>
<div class="section level3">
<h3 id="image-processing">Image Processing<a class="anchor" aria-label="anchor" href="#image-processing"></a>
</h3>
<p>Once we have these images, we can apply image processing techniques
to each gray scale image.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regularise_image.html">regularise_image</a></span><span class="op">(</span><span class="va">vesalius</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-56-01/13/25 21:56:58  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-56-01/13/25 21:56:59  Regularising Image </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:02  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_image.html">smooth_image</a></span><span class="op">(</span><span class="va">vesalius</span>, sigma <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:03  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:04  Smoothing Image Arrays </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:04  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalize_image.html">equalize_image</a></span><span class="op">(</span><span class="va">vesalius</span>, sleft <span class="op">=</span> <span class="fl">5</span>, sright <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:04  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:05  Equalizing Histogram </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:05  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>You can apply any image processing method you wish and in any order
you desire. Please note that the default number of dimensions for these
function is defined by <code>seq(1,3)</code> giving the first three
dimensions. If working with PCA, please set this argument according to
how many dimensions you wish to process.</p>
<p>This also alows for the selction of abitrary of PCs. For example,
based on the grey scale images, you might decided that this would be a
better choice of PCs</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Selecting a subset of PCs</span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># running smoothing o</span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regularise_image.html">regularise_image</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dimensions <span class="op">=</span> <span class="va">dims</span>,</span>
<span>  embedding <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalize_image.html">equalize_image</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dimensions <span class="op">=</span> <span class="va">dims</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_image.html">smooth_image</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  dimensions <span class="op">=</span> <span class="va">dims</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In this example, we explicetely requested the <em>PCA</em> embedding.
This means that we will take a fresh instance of the <em>PCA</em>
embedding and use this as our active embedding. Once specified, all
subsequent functions will use this new active embedding unless specified
otherwise.</p>
<p>However, note that dimensions are being parsed at every step. Only
the images coressponding to these dimensions will be processed. Vesalius
still retains the other ones just in case.</p>
</div>
<div class="section level3">
<h3 id="image-segmentation">Image segmentation<a class="anchor" aria-label="anchor" href="#image-segmentation"></a>
</h3>
<p>Vesalius will attempts to segment the images into color segments.
Vesalius use a kmeans clustering approach to segment grey scale images.
Note that the segmentation here is applied to the whole stack and not
individually.</p>
<p>The goal is top obtain colour segments that we can subdivived into
territories.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment_image.html">segment_image</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"kmeans"</span>,</span>
<span>  col_resolution <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-do-we-have-4">What do we have?<a class="anchor" aria-label="anchor" href="#what-do-we-have-4"></a>
</h3>
<p>We can see that the vesalius_assay object now contains some more
information related to the segmentation.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## spatial_omics as vesalius assay containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 10 modifications applied to base object. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1052 spatial indices used to form pixel tiles. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 15932 observations in the log_norm.3 count matrix. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 4 total embedding trials</span></span>
<span><span class="co">## with PCA.2 as active embedding. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1 Segmentation trials. </span></span>
<span><span class="co">## 0 Territory trials. </span></span>
<span><span class="co">## 0 Morphing trials. </span></span>
<span><span class="co">## 0 Layering trials. </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>We can also have a look at the results of the image segmentation.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Segments only"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p5</span><span class="op">)</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/plot_segments_only-1.png" width="960"></p>
<p>Kmeans is the default setting for image segmentation but Vesalius
also provides <em>louvain</em> and <em>leiden</em> based approaches.</p>
</div>
</div>
<div class="section level2">
<h2 id="isolating-territories">Isolating territories<a class="anchor" aria-label="anchor" href="#isolating-territories"></a>
</h2>
<div class="section level3">
<h3 id="isolating-territories-from-colour-segments">Isolating territories from colour segments<a class="anchor" aria-label="anchor" href="#isolating-territories-from-colour-segments"></a>
</h3>
<p>The final step is to isolate color segments into seperate
territories. Similar color segments may be of the same colour but are
seperated in 2D space. We want to be able to isolate each patch. For
this, we can use the <code>isolate_territories</code> function.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/isolate_territories.html">isolate_territories</a></span><span class="op">(</span><span class="va">vesalius</span>, capture_radius <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:07  Pooling Segment  1 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:07  Pooling Segment  2 </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="section level4">
<h4 id="what-do-we-have-5">What do we have?<a class="anchor" aria-label="anchor" href="#what-do-we-have-5"></a>
</h4>
<p>Now we can have a look at the isolated territories. We can keep track
of how many instances of image segmentation and image manipulation we
have gone through.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## spatial_omics as vesalius assay containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 11 modifications applied to base object. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1052 spatial indices used to form pixel tiles. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 15932 observations in the log_norm.3 count matrix. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 4 total embedding trials</span></span>
<span><span class="co">## with PCA.2 as active embedding. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1 Segmentation trials. </span></span>
<span><span class="co">## 1 Territory trials. </span></span>
<span><span class="co">## 0 Morphing trials. </span></span>
<span><span class="co">## 0 Layering trials. </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="visualizing-territories">Visualizing Territories<a class="anchor" aria-label="anchor" href="#visualizing-territories"></a>
</h3>
<p>We can plot our territories using vesalius plotting functions. Note
that this is a <code>ggplot</code> object as such it is customisable
using <code>ggplot2</code> functionalities.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/territory_plot.html">territory_plot</a></span><span class="op">(</span><span class="va">vesalius</span>, cex_pt <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span></span>
<span><span class="va">p6</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/plot_territories-1.png" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="comparing-territories">Comparing territories<a class="anchor" aria-label="anchor" href="#comparing-territories"></a>
</h2>
<p>Once we have our territories, we can compare the expression of genes
between territories.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identify_markers.html">identify_markers</a></span><span class="op">(</span><span class="va">vesalius</span>, seed <span class="op">=</span> <span class="fl">1</span>, query <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:08 ===&gt; Computing DEGs in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:09 ===&gt; 1 VS 2 &lt;=== </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_markers.html">get_markers</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span></span></code></pre></div>
<p>And finally we can visualise the expression of our genes of interest.
You can parse more than one gene. Here we show the overall expression
profile of <strong>Malat1</strong> but also its mean expression in each
territory.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/view_gene_expression.html">view_gene_expression</a></span><span class="op">(</span><span class="va">vesalius</span>, genes <span class="op">=</span> <span class="st">"Malat1"</span><span class="op">)</span></span>
<span><span class="va">p8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/view_gene_expression.html">view_gene_expression</a></span><span class="op">(</span><span class="va">vesalius</span>, genes <span class="op">=</span> <span class="st">"Malat1"</span>, as_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p7</span> <span class="op">+</span> <span class="va">p8</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/view_DEG-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="mapping-cells-across-samples">Mapping Cells across samples<a class="anchor" aria-label="anchor" href="#mapping-cells-across-samples"></a>
</h2>
<p>Another key features of Vesalius is to be able to map cells across
samples. Here, we will show a quick break down of how to achieve this. A
more in depth view of cell mapping is available in the <a href="https://github.com/WonLab-CS/Vesalius_analysis" class="external-link">Vesalius analysis
repository</a></p>
<div class="section level3">
<h3 id="mapping-cells">Mapping cells<a class="anchor" aria-label="anchor" href="#mapping-cells"></a>
</h3>
<p>First, we build 2 vesalius objects that we have process
independantly. The jitter territory is the same as the original version
but we flipped the coordinates, added noise to coordinates and counts,
and remove a few randomly sampled locations.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load vesalius data </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create Vesalius object for processing</span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_vesalius_assay.html">build_vesalius_assay</a></span><span class="op">(</span><span class="va">coordinates</span>, <span class="va">counts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:11  Checking Coordinates in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:11  Checking Counts in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:11  Calculating Assay scale from coordinates</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">@</span><span class="va">tiles</span><span class="op">)</span>,replace <span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vesalius</span><span class="op">@</span><span class="va">tiles</span><span class="op">$</span><span class="va">barcodes</span></span>
<span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu">add_cells</span><span class="op">(</span><span class="va">vesalius</span>, cells <span class="op">=</span> <span class="va">cells</span>, add_name <span class="op">=</span> <span class="st">"Cells"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:11  Adding cell labels to Cells territory column in spatial_omics </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_vesalius_assay.html">build_vesalius_assay</a></span><span class="op">(</span><span class="va">jitter_coord</span>, <span class="va">jitter_counts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:11  Checking Coordinates in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:11  Checking Counts in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:12  Calculating Assay scale from coordinates</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">jitter_ves</span><span class="op">@</span><span class="va">tiles</span><span class="op">)</span>,replace <span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">jitter_ves</span><span class="op">@</span><span class="va">tiles</span><span class="op">$</span><span class="va">barcodes</span></span>
<span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu">add_cells</span><span class="op">(</span><span class="va">jitter_ves</span>, cells <span class="op">=</span> <span class="va">cells</span>, add_name <span class="op">=</span> <span class="st">"Cells"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:12  Adding cell labels to Cells territory column in spatial_omics </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>    filter_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    filter_grid <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:12 ===&gt; Generating Tiles in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:12  Generating Voronoi Tesselation </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:12  Filtering Tiles</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:12  Rasterising Tiles </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:14  Adjusting count matrix</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:14 ===&gt; Pre-processing counts in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:16 ===&gt; Compute Latent Space in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:16  Running Principal Component Analysis </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:17  Converting PCA Embedding Values to gray scale </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_image.html">smooth_image</a></span><span class="op">(</span><span class="va">vesalius</span>, embedding <span class="op">=</span> <span class="st">"PCA"</span>, sigma <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:17  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:18  Smoothing Image Arrays </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:18  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalize_image.html">equalize_image</a></span><span class="op">(</span><span class="va">vesalius</span>, sleft <span class="op">=</span> <span class="fl">5</span>, sright <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:18  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Equalizing Histogram </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment_image.html">segment_image</a></span><span class="op">(</span><span class="va">vesalius</span>, col_resolution <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Segmenting Image using kmeans </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/isolate_territories.html">isolate_territories</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Pooling Segment  1 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Pooling Segment  2 </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">jitter_ves</span>,</span>
<span>    filter_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    filter_grid <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19 ===&gt; Generating Tiles in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Generating Voronoi Tesselation </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Filtering Tiles</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:19  Rasterising Tiles </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:21  Adjusting count matrix</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:21 ===&gt; Pre-processing counts in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:26 ===&gt; Compute Latent Space in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:26  Running Principal Component Analysis </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:27  Converting PCA Embedding Values to gray scale </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_image.html">smooth_image</a></span><span class="op">(</span><span class="va">jitter_ves</span>, embedding <span class="op">=</span> <span class="st">"PCA"</span>, sigma <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:27  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:28  Smoothing Image Arrays </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:28  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalize_image.html">equalize_image</a></span><span class="op">(</span><span class="va">jitter_ves</span>, sleft <span class="op">=</span> <span class="fl">5</span>, sright <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:28  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Equalizing Histogram </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment_image.html">segment_image</a></span><span class="op">(</span><span class="va">jitter_ves</span>, col_resolution <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Segmenting Image using kmeans </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jitter_ves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/isolate_territories.html">isolate_territories</a></span><span class="op">(</span><span class="va">jitter_ves</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Pooling Segment  1 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Pooling Segment  2 </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>Next, we can proceed with the mapping of cells on to the other. We
will run the mapping using cell (feature), niche, territory similarity
and cell composition.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_assays.html">map_assays</a></span><span class="op">(</span><span class="va">vesalius</span>,</span>
<span>    <span class="va">jitter_ves</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    use_cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feature"</span>,<span class="st">"niche"</span>,<span class="st">"territory"</span>,<span class="st">"composition"</span><span class="op">)</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    epoch <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    jitter <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Extracting assay signal</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:29  Computing Feature cost in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:30  Getting Neighborhoods in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:31  Computing Neighborhood cost in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:31  Computing Territory cost in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:33  Computing Niche Composition Index in spatial_omics </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:39  Mapping query to seed - Epoch =  1 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:40  Mapping query to seed - Epoch =  2 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:41  Mapping query to seed - Epoch =  3 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:41  Mapping query to seed - Epoch =  4 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:41  Mapping query to seed - Epoch =  5 </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:41  Filtering Mapped Indices </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>The mapping produces a new vesalius object with mapped coordinates
for the query data set. In this case our query was
<code>jitter_ves</code>.</p>
<p>From here, we can treat this new object as a frech data sets with new
coordinates. As such:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_embeddings.html">generate_embeddings</a></span><span class="op">(</span><span class="va">matched</span>,</span>
<span>    dim_reduction <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  nfeatures <span class="op">=</span> <span class="fl">200</span>, </span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_image.html">smooth_image</a></span><span class="op">(</span><span class="va">matched</span>, sigma <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:48  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:49  Smoothing Image Arrays </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:50  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalize_image.html">equalize_image</a></span><span class="op">(</span><span class="va">matched</span>, sleft <span class="op">=</span> <span class="fl">5</span>, sright <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:50  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:51  Equalizing Histogram </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:51  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment_image.html">segment_image</a></span><span class="op">(</span><span class="va">matched</span>,col_resolution <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:51  Segmenting Image using kmeans </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>We can then look at the resulting embeddings</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">jitter_ves</span><span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">+</span> <span class="va">m1</span> <span class="op">+</span> <span class="va">m2</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/map_image_plot-1.png" width="1152"></p>
<p>We can also look at the new territories.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/territory_plot.html">territory_plot</a></span><span class="op">(</span><span class="va">vesalius</span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/territory_plot.html">territory_plot</a></span><span class="op">(</span><span class="va">jitter_ves</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/territory_plot.html">territory_plot</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span>
<span><span class="va">t</span> <span class="op">+</span> <span class="va">t1</span> <span class="op">+</span> <span class="va">t2</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/map_territory-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="integrating-data-sets">Integrating data sets<a class="anchor" aria-label="anchor" href="#integrating-data-sets"></a>
</h3>
<p>Once we have our data sets and the new set of coordinates, we can
integrate the data sets to obtain an integrate mapping object upon which
we can perform differential gene expression analysis.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/integrate_assays.html">integrate_assays</a></span><span class="op">(</span><span class="va">matched</span>,</span>
<span>    <span class="va">vesalius</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-57-01/13/25 21:57:57  Intergrating Counts</span></span></code></pre>
<pre><code><span><span class="co">## Warning in merge_coordinates(mapped, reference,</span></span>
<span><span class="co">## rownames(integrated$integrated)): No duplicated coordinates allowed - Adding</span></span>
<span><span class="co">## noise!</span></span></code></pre>
<pre><code><span><span class="co">## 2025-58-01/13/25 21:58:05 ===&gt; Generating Tiles in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:05  Generating Voronoi Tesselation </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:05  Filtering Tiles</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:05  Rasterising Tiles </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:08  Adjusting count matrix</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:08  Setting integrated as active embedding </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:08  Setting inferred as active count matrix </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>Since this data set now contains an integrated latent space, we can
also call territories on this object. There is no need to create new
embeddings. They are provided during integration.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_image.html">smooth_image</a></span><span class="op">(</span><span class="va">inter</span>, sigma <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:09  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:09  Smoothing Image Arrays </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:09  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalize_image.html">equalize_image</a></span><span class="op">(</span><span class="va">inter</span>, sleft <span class="op">=</span> <span class="fl">5</span>, sright <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:10  Converting Vesalius to Image</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:10  Equalizing Histogram </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:10  Converting Images to Vesalius</span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment_image.html">segment_image</a></span><span class="op">(</span><span class="va">inter</span>, col_resolution <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:11  Segmenting Image using kmeans </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<p>We can view the resulting embeddings and territories.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_plot.html">image_plot</a></span><span class="op">(</span><span class="va">inter</span><span class="op">)</span></span>
<span><span class="va">i1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/territory_plot.html">territory_plot</a></span><span class="op">(</span><span class="va">inter</span><span class="op">)</span></span>
<span></span>
<span><span class="va">i</span> <span class="op">+</span> <span class="va">i1</span></span></code></pre></div>
<p><img src="vesalius_files/figure-html/inter_plot-1.png" width="864"></p>
</div>
<div class="section level3">
<h3 id="deg-analysis-between-samples">DEG analysis between samples<a class="anchor" aria-label="anchor" href="#deg-analysis-between-samples"></a>
</h3>
<p>Finally, we can look at DEG analysis between samples in specific
territories.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identify_markers.html">identify_markers</a></span><span class="op">(</span><span class="va">inter</span>, sample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## #--------------------------------------------------------------------------------# </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:13  No territory Specified - Comparing all territories</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:13 ===&gt; Computing DEGs in spatial_omics &lt;===</span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:13 ===&gt; 1_reference VS remaining_matched &lt;=== </span></span>
<span><span class="co">## 2025-58-01/13/25 21:58:13 ===&gt; 2_reference VS remaining_matched &lt;=== </span></span>
<span><span class="co">## #--------------------------------------------------------------------------------#</span></span></code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">degs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_markers.html">get_markers</a></span><span class="op">(</span><span class="va">inter</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">degs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         genes       p_value   p_value_adj  seed_pct query_pct fold_change</span></span>
<span><span class="co">## Lrrtm4 Lrrtm4 4.019193e-135 1.197720e-132 0.5170279 0.9899497  -1.0924661</span></span>
<span><span class="co">## Kcnd2   Kcnd2 2.046193e-113 4.788093e-111 0.3343653 0.9045226  -0.8337322</span></span>
<span><span class="co">## Kcnip4 Kcnip4 4.170444e-125 1.171895e-122 0.7383901 0.9974874  -0.9770361</span></span>
<span><span class="co">## Lsamp   Lsamp  3.629134e-59  1.161323e-57 1.0000000 1.0000000  -0.5171473</span></span>
<span><span class="co">## Dlg2     Dlg2 1.511475e-106 3.113639e-104 0.5479876 0.9874372  -0.7059400</span></span>
<span><span class="co">## Slit3   Slit3 4.832167e-107 1.009923e-104 0.1795666 0.8090452  -0.4566776</span></span>
<span><span class="co">##        effect_size        seed             query</span></span>
<span><span class="co">## Lrrtm4    1.411291 1_reference remaining_matched</span></span>
<span><span class="co">## Kcnd2     1.411291 1_reference remaining_matched</span></span>
<span><span class="co">## Kcnip4    1.411291 1_reference remaining_matched</span></span>
<span><span class="co">## Lsamp     1.087245 1_reference remaining_matched</span></span>
<span><span class="co">## Dlg2      1.411291 1_reference remaining_matched</span></span>
<span><span class="co">## Slit3     1.411291 1_reference remaining_matched</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.2 (2024-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.1 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] ggplot2_3.5.1   patchwork_1.3.0 vesalius_2.0.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] RcppAnnoy_0.0.22            splines_4.4.2              </span></span>
<span><span class="co">##   [3] later_1.4.1                 bitops_1.0-9               </span></span>
<span><span class="co">##   [5] R.oo_1.27.0                 tibble_3.2.1               </span></span>
<span><span class="co">##   [7] polyclip_1.10-7             fastDummies_1.7.4          </span></span>
<span><span class="co">##   [9] lifecycle_1.0.4             Rdpack_2.6.2               </span></span>
<span><span class="co">##  [11] rstatix_0.7.2               edgeR_4.4.1                </span></span>
<span><span class="co">##  [13] globals_0.16.3              lattice_0.22-6             </span></span>
<span><span class="co">##  [15] MASS_7.3-61                 readbitmap_0.1.5           </span></span>
<span><span class="co">##  [17] backports_1.5.0             magrittr_2.0.3             </span></span>
<span><span class="co">##  [19] limma_3.62.2                plotly_4.10.4              </span></span>
<span><span class="co">##  [21] sass_0.4.9                  rmarkdown_2.29             </span></span>
<span><span class="co">##  [23] jquerylib_0.1.4             yaml_2.3.10                </span></span>
<span><span class="co">##  [25] httpuv_1.6.15               Seurat_5.1.0               </span></span>
<span><span class="co">##  [27] sctransform_0.4.1           spam_2.11-0                </span></span>
<span><span class="co">##  [29] sp_2.1-4                    spatstat.sparse_3.1-0      </span></span>
<span><span class="co">##  [31] reticulate_1.40.0           cowplot_1.1.3              </span></span>
<span><span class="co">##  [33] pbapply_1.7-2               RColorBrewer_1.1-3         </span></span>
<span><span class="co">##  [35] abind_1.4-8                 zlibbioc_1.52.0            </span></span>
<span><span class="co">##  [37] R.cache_0.16.0              Rtsne_0.17                 </span></span>
<span><span class="co">##  [39] GenomicRanges_1.58.0        R.utils_2.12.3             </span></span>
<span><span class="co">##  [41] purrr_1.0.2                 RCurl_1.98-1.16            </span></span>
<span><span class="co">##  [43] imagerExtra_1.3.2           BiocGenerics_0.52.0        </span></span>
<span><span class="co">##  [45] GenomeInfoDbData_1.2.13     IRanges_2.40.1             </span></span>
<span><span class="co">##  [47] S4Vectors_0.44.0            ggrepel_0.9.6              </span></span>
<span><span class="co">##  [49] irlba_2.3.5.1               kohonen_3.0.12             </span></span>
<span><span class="co">##  [51] listenv_0.9.1               spatstat.utils_3.1-2       </span></span>
<span><span class="co">##  [53] goftest_1.2-3               RSpectra_0.16-2            </span></span>
<span><span class="co">##  [55] spatstat.random_3.3-2       fitdistrplus_1.2-2         </span></span>
<span><span class="co">##  [57] parallelly_1.41.0           pkgdown_2.1.1              </span></span>
<span><span class="co">##  [59] leiden_0.4.3.1              codetools_0.2-20           </span></span>
<span><span class="co">##  [61] DelayedArray_0.32.0         RcppRoll_0.3.1             </span></span>
<span><span class="co">##  [63] tidyselect_1.2.1            UCSC.utils_1.2.0           </span></span>
<span><span class="co">##  [65] farver_2.1.2                imager_1.0.2               </span></span>
<span><span class="co">##  [67] matrixStats_1.5.0           stats4_4.4.2               </span></span>
<span><span class="co">##  [69] spatstat.explore_3.3-4      jsonlite_1.8.9             </span></span>
<span><span class="co">##  [71] bmp_0.3                     progressr_0.15.1           </span></span>
<span><span class="co">##  [73] Formula_1.2-5               ggridges_0.5.6             </span></span>
<span><span class="co">##  [75] survival_3.7-0              systemfonts_1.1.0          </span></span>
<span><span class="co">##  [77] TreeTools_1.13.0            tools_4.4.2                </span></span>
<span><span class="co">##  [79] ggnewscale_0.5.0            ragg_1.3.3                 </span></span>
<span><span class="co">##  [81] ica_1.0-3                   Rcpp_1.0.13-1              </span></span>
<span><span class="co">##  [83] glue_1.8.0                  gridExtra_2.3              </span></span>
<span><span class="co">##  [85] SparseArray_1.6.0           xfun_0.50                  </span></span>
<span><span class="co">##  [87] DESeq2_1.46.0               MatrixGenerics_1.18.1      </span></span>
<span><span class="co">##  [89] GenomeInfoDb_1.42.1         dplyr_1.1.4                </span></span>
<span><span class="co">##  [91] withr_3.0.2                 fastmap_1.2.0              </span></span>
<span><span class="co">##  [93] shinyjs_2.1.0               digest_0.6.37              </span></span>
<span><span class="co">##  [95] R6_2.5.1                    mime_0.12                  </span></span>
<span><span class="co">##  [97] textshaping_0.4.1           colorspace_2.1-1           </span></span>
<span><span class="co">##  [99] scattermore_1.2             tensor_1.5                 </span></span>
<span><span class="co">## [101] jpeg_0.1-10                 spatstat.data_3.1-4        </span></span>
<span><span class="co">## [103] R.methodsS3_1.8.2           tidyr_1.3.1                </span></span>
<span><span class="co">## [105] generics_0.1.3              data.table_1.16.4          </span></span>
<span><span class="co">## [107] httr_1.4.7                  htmlwidgets_1.6.4          </span></span>
<span><span class="co">## [109] S4Arrays_1.6.0              uwot_0.2.2                 </span></span>
<span><span class="co">## [111] pkgconfig_2.0.3             gtable_0.3.6               </span></span>
<span><span class="co">## [113] lmtest_0.9-40               XVector_0.46.0             </span></span>
<span><span class="co">## [115] htmltools_0.5.8.1           carData_3.0-5              </span></span>
<span><span class="co">## [117] pwr_1.3-0                   dotCall64_1.2              </span></span>
<span><span class="co">## [119] fftwtools_0.9-11            SeuratObject_5.0.2         </span></span>
<span><span class="co">## [121] scales_1.3.0                Biobase_2.66.0             </span></span>
<span><span class="co">## [123] png_0.1-8                   spatstat.univar_3.1-1      </span></span>
<span><span class="co">## [125] tvR_0.3.2                   knitr_1.49                 </span></span>
<span><span class="co">## [127] Signac_1.14.0               reshape2_1.4.4             </span></span>
<span><span class="co">## [129] nlme_3.1-166                cachem_1.1.0               </span></span>
<span><span class="co">## [131] zoo_1.8-12                  stringr_1.5.1              </span></span>
<span><span class="co">## [133] KernSmooth_2.23-24          parallel_4.4.2             </span></span>
<span><span class="co">## [135] miniUI_0.1.1.1              desc_1.4.3                 </span></span>
<span><span class="co">## [137] infix_0.1.0                 pillar_1.10.1              </span></span>
<span><span class="co">## [139] grid_4.4.2                  vctrs_0.6.5                </span></span>
<span><span class="co">## [141] TreeDist_2.9.2              RANN_2.6.2                 </span></span>
<span><span class="co">## [143] PlotTools_0.3.1             promises_1.3.2             </span></span>
<span><span class="co">## [145] ggpubr_0.6.0                car_3.1-3                  </span></span>
<span><span class="co">## [147] xtable_1.8-4                cluster_2.1.6              </span></span>
<span><span class="co">## [149] evaluate_1.0.3              cli_3.6.3                  </span></span>
<span><span class="co">## [151] locfit_1.5-9.10             compiler_4.4.2             </span></span>
<span><span class="co">## [153] Rsamtools_2.22.0            rlang_1.1.4                </span></span>
<span><span class="co">## [155] crayon_1.5.3                future.apply_1.11.3        </span></span>
<span><span class="co">## [157] ggsignif_0.6.4              labeling_0.4.3             </span></span>
<span><span class="co">## [159] plyr_1.8.9                  fs_1.6.5                   </span></span>
<span><span class="co">## [161] stringi_1.8.4               viridisLite_0.4.2          </span></span>
<span><span class="co">## [163] deldir_2.0-4                BiocParallel_1.40.0        </span></span>
<span><span class="co">## [165] munsell_0.5.1               Biostrings_2.74.1          </span></span>
<span><span class="co">## [167] tiff_0.1-12                 lazyeval_0.2.2             </span></span>
<span><span class="co">## [169] spatstat.geom_3.3-4         Matrix_1.7-1               </span></span>
<span><span class="co">## [171] RcppHNSW_0.6.0              bit64_4.5.2                </span></span>
<span><span class="co">## [173] future_1.34.0               statmod_1.5.0              </span></span>
<span><span class="co">## [175] shiny_1.10.0                SummarizedExperiment_1.36.0</span></span>
<span><span class="co">## [177] rbibutils_2.3               ROCR_1.0-11                </span></span>
<span><span class="co">## [179] memoise_2.0.1               igraph_2.1.3               </span></span>
<span><span class="co">## [181] broom_1.0.7                 bslib_0.8.0                </span></span>
<span><span class="co">## [183] fastmatch_1.1-6             bit_4.5.0.1                </span></span>
<span><span class="co">## [185] ape_5.8-1</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick C.N. Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
